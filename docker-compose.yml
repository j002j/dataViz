services:
  mapillary-pipeline:
    build:
      context: .
      dockerfile: Dockerfile
    # The default command from your run_pipeline script
    command: python -m pipelines.run_mapillary_pipeline
    env_file:
      - .env
    environment:
      - TORCH_DISABLE_NNPACK=1
    volumes:
      # Mount the output directory to your host machine
      - ./cropped_people:/app/cropped_people
      # Mount the app code
      - .:/app
      # NEW: Mount a host directory to persist the SQLite database
      - ./data:/app/data

  web-explorer:
    build:
      context: .
      dockerfile: Dockerfile
    command: python web_explorer.py
    ports:
      - "8080:8080"
    volumes:
      - .:/app
      - ./data:/app/data
    env_file:
      - .env